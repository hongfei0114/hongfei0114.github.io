# 数据库设计

## 数据类型

###  数字类型之整数类型

![](https://tva1.sinaimg.cn/large/00831rSTly1gd91w5zaluj30ng05p42d.jpg)

![](https://tva1.sinaimg.cn/large/00831rSTly1gd92flzgkmj30o003h77s.jpg)

- mysql不仅支持标准SQL中的integer和smallint类型，还支持一些自己的扩展整数类型
- mysql可以为证书类型指定宽度，比如INT(11)，这个限制对大多数应用没有意义。因为这不是限制值的合法范围，对于存储和计算来说，INT(1)和INT(20)是相同的，只是对一些MySQL的交互工具规定了显示字符的个数，比如MySQL命令行客户端。



###  数字类型之固定浮点类型

- Decimal和numeric数据类型用来存储高精度数据，一般只在对小数进行精确计算时才使用，比如设计财务数据的时候
  - `DECIMAL [(M,[D])] [UNSIGNED]`
- 在MySQL中，numeric和decimal的含义相同

- Decimal的使用方法举例为decimal(5,2)
  - 其中5代表精度，表示了可以使用多少位数字（整数位+小数位）
  - 其中的2代表小数点后面的小数位数
  - 此例子的取值范围为-999.99~999.22
- 当不需要指定小数时，可以使用decimal(M)，decimal(M,0)来表示
- 当直接使用decimal时，则默认的M为10
- M的最大取值为65，D的最大取值为30，当D为0时可以用来存储比BIGHT更大范围的证书值
- 当指定UNSIGED，表示不允许负数。
- MySQL对decimal字段采用每4个字节存储9个数字的方式，例如decimal(18,9)，小数点两边各存储9个数字，一共使用9个字节。小数点前的数字用4个字节，小数点后的数字用9个字节，小数点本身占一个字节

###   数据类型之浮点类型

- 浮点类型中包含float和double两种，与decimal相比是不精确类型
- floal([M, D])[UNSIGNED]中的M代表可以使用的数字位数，D则代表小数点后的小数位数。
- Unsigned（无） 代表不允许使用负数
- double的取值范围比floal的范围要大
- 在存储同样范围的值时，通常decimal使用更多的字节。



###    日期类型

- 日期或者时间类型包括date，time，datetime，timestamp和year
- date类型仅表示时间，默认日期格式为yyyy-mm-dd，取值范围为1000-01-01~9999-12-31
- datetime用来表示日期和时间，其默认格式为yyyy-mm-dd hh:mm:ss，取值范围为1000-01-01 00:00:00  ~ 9999-12-31 23:59:59
- timestamp也用来表示时间和日期，其取值范围为1970-01-01 00:00:01~2039-01-19 03:14:07
- datetime和timestamp都可以保存到微妙界别，即6位毫秒精度。
- 非法的data，datatime，timestamp值将被转换为0值，0000-00-00或者0000-00-00 00:00:00
- time类型仅用来表示时间，MySQl默认时间格式为HH:mm:ss，其取值范围为-838:59:59~838:59:59。小时字段可以超过24是因为time类型不光表示小时，也可以代表持续时长中的小时
- time类型也可以包含6位毫秒微秒精度
- Year类型仅用来表示年份，MySQL默认格式为YYYY，其取值范围为1901-2155和0000，针对非法的year数据，则直接转化为0000



```SQL
mysql> desc temp;
+-------+-----------+------+-----+-------------------+-----------------------------+
| Field | Type      | Null | Key | Default           | Extra                       |
+-------+-----------+------+-----+-------------------+-----------------------------+
| id    | int(11)   | YES  |     | NULL              |                             |
| a     | datetime  | YES  |     | CURRENT_TIMESTAMP |                             |
| b     | timestamp | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |
+-------+-----------+------+-----+-------------------+-----------------------------+
3 rows in set (0.00 sec)
```

```SQL
on update CURRENT_TIMESTAMP   # 对当前字段进行修改时，修改这个时间戳
```

- Timestamp和datetime日期时间类型可以被自动初始化和更新为当前的日期时间数据，当你默认指定current timestamp为默认值，或者指定次数据列为自动更新时
  - 指定more值是指当插入新的数据而该列没有指定数值时，则插入当前时间戳
  - 指定自动更新是指当行中的其他列被更新时，此列自动更新为当前时间戳
  - 在5.6，5.7中指定数据类型为timestamp，会有以上两个特性。





###  字符类型



![](https://tva1.sinaimg.cn/large/00831rSTly1gda3rw3o3cj30xu0maqoo.jpg)





![](https://tva1.sinaimg.cn/large/00831rSTly1gda4cj9a0lj30w90kz4fo.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda4dpo9jaj30w40l3alw.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda4f9mqwfj30t90m214h.jpg)

```SQL
mysql> create table vc (v varchar(4), c ChAR(4));
Query OK, 0 rows affected (0.02 sec)

mysql> insert into vc values('ab', 'ab');
Query OK, 1 row affected (0.00 sec)

mysql> select * from vc;
+------+------+
| v    | c    |
+------+------+
| ab   | ab   |
+------+------+
1 row in set (0.00 sec)

mysql> select concat(v,'@'), concat(c, '@') from vc;
+---------------+----------------+
| concat(v,'@') | concat(c, '@') |
+---------------+----------------+
| ab@           | ab@            |
+---------------+----------------+
1 row in set (0.00 sec)

mysql> insert into vc values('abc ', 'abc ');
Query OK, 1 row affected (0.00 sec)
mysql> select concat(v,'@'), concat(c, '@') from vc;
+---------------+----------------+
| concat(v,'@') | concat(c, '@') |
+---------------+----------------+
| ab@           | ab@            |
| abc @         | abc@           |
+---------------+----------------+
2 rows in set (0.00 sec)
```



### 其他数据类型

- 二进制

  ![](https://tva1.sinaimg.cn/large/00831rSTly1gda4mh8rt2j30wr0lg7hr.jpg)

- 大数据类型

  ![image-20200329005300823](/Users/wph/Library/Application Support/typora-user-images/image-20200329005300823.png)



- 枚举类型

  ![](https://tva1.sinaimg.cn/large/00831rSTly1gda4qagnz3j30wc0l5drg.jpg)

  ![](https://tva1.sinaimg.cn/large/00831rSTly1gda4tui1ztj30xh0lknbl.jpg)

- set类型

  ![](https://tva1.sinaimg.cn/large/00831rSTly1gda4wsdck4j30wc0krn7t.jpg)

  

### 数据类型之如何选择类型

![](https://tva1.sinaimg.cn/large/00831rSTly1gda51ftbw7j30v60jttk0.jpg)

null设置为not unll default...



![](https://tva1.sinaimg.cn/large/00831rSTly1gda53dl76rj30sv0czzpv.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda54oj2gdj30s30bxn3t.jpg)

可以指定下一行自增 字段的起始值：

![](https://tva1.sinaimg.cn/large/00831rSTly1gda57qdmg8j310f06342m.jpg)



##  存储引擎

###  存储引擎比较

```SQl
mysql> show ENGINES;
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
9 rows in set (0.00 sec)
```



![](https://tva1.sinaimg.cn/large/00831rSTly1gda5ahcb4sj31g40es0vk.jpg)

InnoDB    Supports transactions, row-level locking, and foreign keys 





![](https://tva1.sinaimg.cn/large/00831rSTly1gda5fwi7yuj30s60kham1.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda5guv4puj30us0j1tlv.jpg)

`show variables like '%storage%'`



![](https://tva1.sinaimg.cn/large/00831rSTly1gda5kevz3xj30rs0hi174.jpg)





- 使用InnoDB存储引擎的优势：
  - DML语句支持事务功能，保证ACID特性
  - 行级锁的使用保证了高并发的属性
  - InnoDB对有主键的表会依据主键。。。
  - 为保证数据的一致性，InnoDB支持外键属性。。。
- MyISAM
  - 老版本默认<=5.5
  - 表级锁



![](https://tva1.sinaimg.cn/large/00831rSTly1gda5u3vr67j30r70hagv1.jpg)





![](https://tva1.sinaimg.cn/large/00831rSTly1gda5yex49tj30r90e043l.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda5zldcbbj30sm0cxn5g.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda61d5h33j30q10eugse.jpg)

![](https://tva1.sinaimg.cn/large/00831rSTly1gda64qlknlj30q80eo44w.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda65ih8djj30rd0f1gsk.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda65oclo0j30qq04udhk.jpg)

NDB不存在与社区版，存在与cluster版



##  数据库设计范式要求

### 设计方法之E-R模型

![](https://tva1.sinaimg.cn/large/00831rSTly1gda67l2qc9j30u00gk7fx.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda6gt4o36j30r50bp7af.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda6le0dsxj30va0in4cc.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda6lqx0icj30tm0i013z.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda6sloe2nj30ts0m3dor.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda6wkwfuqj30mo0hcgpk.jpg)



![image-20200329021150381](/Users/wph/Library/Application Support/typora-user-images/image-20200329021150381.png)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda74cduxpj30tg0h8tm7.jpg)





## 数据库设计常用工具

### 常用工具之powerdesigner





###  常用工具之workbench





![](https://tva1.sinaimg.cn/large/00831rSTly1gda7l2hurtj30si0bm7cl.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda7m55zkfj30su07vjvx.jpg)



##  MySQL设计方法之字段考虑



![](https://tva1.sinaimg.cn/large/00831rSTly1gda7rqpudyj30s40iqk5p.jpg)



![ ](https://tva1.sinaimg.cn/large/00831rSTly1gda7ub0mrjj30v60kdtm9.jpg)



![](https://tva1.sinaimg.cn/large/00831rSTly1gda88tfpe5j30ry0jqao7.jpg)





















